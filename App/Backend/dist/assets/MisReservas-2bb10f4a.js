import{r as t,b as q,j as e,v as z,o as B,k as D,q as C,x as P,y as A,z as T,B as R,D as k,F as V,G as O,u as U,H as L,P as $}from"./index-3d224542.js";import{e as W}from"./eye-slash-d3ee0e19.js";import{F as H}from"./FormVacio-e97425c3.js";import{u as Z,d as Y,g as J}from"./reservas.services-34d7ac23.js";import{p as K}from"./pencil-solid-d38e41d0.js";import{c as F}from"./xmark-solid-4f97102d.js";import{M as I}from"./Modal-9bc1f641.js";import{L as Q}from"./LoaderComponent-1b37c472.js";function X({showModalUpdate:r,reserva:s,handleCloseModalUpdate:c}){var o,u,_,S,a,d,M;const f=t.useId(),j=t.useId(),h=t.useId(),v=new Date(s.fecha).toISOString().split("T")[0],{register:m,handleSubmit:N,formState:l,setValue:b}=q({mode:"onBlur"}),[p,g]=t.useState({isSubmitted:!1,isGood:!1,msg:""}),{errors:i}=l;function y(){p.isGood?(g({isSubmitted:!1,isGood:!1,msg:""}),c()):g({isSubmitted:!1,isGood:!1,msg:""})}function x(n,E="Hubo un error al modificar tu reserva"){g({isSubmitted:!0,isGood:n,msg:n?"Tu reserva ha sido modificada correctamente":E})}async function w(n){if(n.cliente==s.cliente_reserva&&parseInt(n.comensales)==s.cantidad_personas&&n.fecha==v&&n.hora==s.hora&&n.zona==s.lugar)g({isSubmitted:!0,isGood:!1,msg:"No se ha modificado ningun campo"});else{if(!C(n.hora,n.fecha)){x(!1,"La hora ingresada es antigua");return}(await Z(s.id,{...n,estado:"A Confirmar"})).status===200?x(!0):x(!1)}}return t.useEffect(()=>{b("zona",s.lugar)}),e.jsx(e.Fragment,{children:r&&e.jsxs("div",{className:"modal-modificar",children:[e.jsx("h1",{children:"Modificar Datos"}),e.jsx("img",{className:"modal-closebutton",src:F,alt:"Close Button",onClick:c}),e.jsx("div",{className:"modal-modificar__container",children:e.jsxs("form",{className:"reservas__form",onSubmit:N(w),children:[e.jsxs("div",{className:"reservas__row",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Fecha"}),e.jsx("input",{type:"date",defaultValue:v,...m("fecha",{required:!0,validate:z})})]}),((o=i.fecha)==null?void 0:o.type)==="required"&&e.jsx("p",{role:"alert",className:"form-error",children:"La fecha es requerida."}),((u=i.fecha)==null?void 0:u.type)==="validate"&&e.jsx("p",{role:"alert",className:"form-error",children:"La fecha es pasada."})]}),e.jsxs("div",{className:"reservas__row",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Hora"}),e.jsx("input",{type:"time",defaultValue:s.hora,...m("hora",{required:!0,validate:B})})]}),((_=i.hora)==null?void 0:_.type)==="required"&&e.jsx("p",{role:"alert",className:"form-error",children:"La hora es requerida."}),((S=i.hora)==null?void 0:S.type)==="validate"&&e.jsx("p",{role:"alert",className:"form-error",children:"Debe ser entre las 19:00hs y 23:00hs."})]}),e.jsxs("div",{className:"reservas__row",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:f,children:"Numero de comensales"}),e.jsx("input",{type:"number",id:f,defaultValue:s.cantidad_personas,...m("comensales",{required:!0})})]}),((a=i.comensales)==null?void 0:a.type)==="required"&&e.jsxs(e.Fragment,{children:[e.jsx("p",{role:"alert",className:"form-error",children:"La cantidad de comensales"}),e.jsx("p",{role:"alert",className:"form-error",children:" es requerida."})]})]}),e.jsx("div",{className:"reservas__row",children:e.jsxs("div",{children:[e.jsx("label",{htmlFor:j,children:"Zona a reservar"}),e.jsxs("select",{name:j,id:j,...m("zona",{required:!0}),children:[e.jsx("option",{value:"Terraza",children:"Terraza"}),e.jsx("option",{value:"Terraza Norte",children:"Terraza Norte"}),e.jsx("option",{value:"Salon",children:"Salon"}),e.jsx("option",{value:"Patio",children:"Patio"})]})]})}),e.jsxs("div",{className:"reservas__row",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:h,children:"A nombre de"}),e.jsx("input",{type:"text",name:h,id:h,defaultValue:s.cliente_reserva,...m("cliente",{required:!0,pattern:D})})]}),((d=i.cliente)==null?void 0:d.type)==="required"&&e.jsx("p",{role:"alert",className:"form-error",children:"El nombre es requerido"}),((M=i.cliente)==null?void 0:M.type)==="pattern"&&e.jsx("p",{role:"alert",className:"form-error",children:"El nombre solo debe incluir letras"})]}),e.jsx("div",{className:"button__wrapper",children:e.jsx("button",{className:"button",type:"submit",children:"ACTUALIZAR"})})]})}),e.jsx(I,{isSubmitted:p.isSubmitted,isGoodStatus:p.isGood,handleSubmit:y,msg:p.msg,offset:-120})]})})}const ee=[{status:"A Confirmar",img:k},{status:"Reservado",img:V},{status:"Cancelado",img:O}];function se({booking:r,fechaHoy:s}){const c=new Date(r.fecha).toISOString().split("T")[0],f=1,[j,h]=t.useState(window.innerWidth>768),[v,m]=t.useState({isClicked:!1,isGood:!1,msg:""}),[N,l]=t.useState(!1);function b(o){const u=ee.find(_=>_.estado===o);return u?u.img:null}function p(){m({isClicked:!1,isGood:!1})}function g(){l(!1)}function i(o,u){m({isClicked:!0,isGood:o,msg:u})}async function y(){if(c>=s){const o=T(r.hora);R(o)>=f?(await Y(r.id)).status==200?i(!0,"Reserva cancelada correctamente"):i(!1,"Hubo un error al eliminar su reserva, intente mas tarde"):i(!1,`No se puede cancelar la reserva faltando menos de ${f} hora/s`)}}async function x(){if(c==s){const o=T(r.hora);R(o)>=f?l(!0):i(!1,`No se puede modificar la reserva faltando menos de ${f} hora/s`)}else c>s&&l(!0)}const w=`${c.substring(8,10)}/${c.substring(5,7)}`;return t.useEffect(()=>{const o=()=>{h(window.innerWidth>768)};return window.addEventListener("resize",o),()=>{window.removeEventListener("resize",o)}},[]),e.jsxs("div",{className:"datos__body-row",children:[e.jsx("div",{className:"datos__body-dato",children:w}),e.jsx("div",{className:"datos__body-dato",children:r.hora}),e.jsxs("div",{className:"datos__body-dato datos__body-comensales",children:[e.jsx("img",{src:P,className:"user-icon",alt:"Cantidad de personas"}),r.cantidad_personas]}),e.jsx("div",{className:"datos__body-dato",children:r.lugar}),e.jsxs("div",{className:"datos__body-dato",children:[e.jsx("img",{src:b(),alt:r.estado,className:"status-img"}),j&&e.jsx("p",{children:r.estado})]}),e.jsxs("div",{className:"datos__body-dato acciones",children:[e.jsx("img",{src:K,alt:"Modificar",className:C(r.hora,c)?"new":"old",onClick:()=>x()}),e.jsx("img",{src:F,alt:"Eliminar",className:C(r.hora,c)?"new":"old",onClick:()=>y()})]}),e.jsx(I,{isSubmitted:v.isClicked,isGoodStatus:v.isGood,handleSubmit:p,msg:v.msg,position:"top"}),N&&e.jsx(A,{comp:"reserva",children:e.jsx(X,{showModalUpdate:N,reserva:r,handleCloseModalUpdate:g})})]},r.id)}function me(){const{auth:r}=U(),[s,c]=t.useState([]),[f,j]=t.useState(!0),[h,v]=t.useState(!0),[m,N]=t.useState({isSubmitted:!1,existError:!1,msg:""}),[l,b]=t.useState(1),[p,g]=t.useState(0),[i,y]=t.useState([]),x=6,w=new Date().toISOString().split("T")[0];t.useEffect(()=>{async function a(){if(r.data.user_id){const d=await J({user_id:r.data.user_id});c(d.data.data)}}a().then(()=>{j(!1)}).catch(j(!1))},[r.data.user_id]),t.useEffect(()=>{const a=[];for(let d=1;d<=Math.ceil((o().length==0?1:o().length)/x);d++)a.push(d);y(a),S(1)},[s,h]);function o(){if(s.length<=0)return[];if(h){const a=s.filter(d=>{if(L(d.fecha)>=L(w))return d});return a.length<=0?[]:a}else return s}function u(){const d=L(new Date);if(s.length<=0)return e.jsx(H,{msg:"Aun no tienes ninguna reserva hoy",msgButton:"RESERVAR",goTo:"reservas"});{const M=o();return M.length<=0?e.jsx(H,{msg:"Aun no tienes ninguna reserva hoy",msgButton:"RESERVAR",goTo:"reservas"}):M.slice(p,x+p).map(n=>{const E=n.fecha,G=new Date(E).toLocaleDateString();return e.jsx(se,{fechaLegible:G,booking:n,fechaHoy:d},n.id)})}}function _(){N({isSubmitted:!1,existError:!1,msg:""}),document.body.classList.remove("disable-scroll")}function S(a){a!==l&&(window.scrollTo(0,10),b(a),g((a-1)*x))}return e.jsxs("div",{className:"misreservas__container",children:[e.jsx($,{pathPrev:"Home",pathActual:"Mis Reservas",goTo:"home"}),e.jsxs("div",{className:"misreservas__form",children:[e.jsxs("div",{className:"misreservas__filter",onClick:()=>v(!h),children:[e.jsx("img",{src:W,alt:"Icono de oculto"}),e.jsx("p",{children:h?"Mostrar reservas antiguas":"Ocultar reservas antiguas"})]}),e.jsxs("div",{className:"misreservas__datos",children:[e.jsxs("div",{className:"datos__header",children:[e.jsx("p",{className:"datos__header-column",children:"Fecha"}),e.jsx("p",{className:"datos__header-column",children:"Hora"}),e.jsx("p",{className:"datos__header-column",children:"Comens."}),e.jsx("p",{className:"datos__header-column",children:"Lugar"}),e.jsx("p",{className:"datos__header-column",children:"Estado"}),e.jsx("p",{className:"datos__header-column",children:"Acciones"})]}),e.jsx("div",{className:"datos__body",children:f?e.jsx(Q,{size:"small",color:"orange"}):u()})]})]}),i.length>1&&e.jsx("div",{className:"misreservas__paginacion-wrapper",children:e.jsxs("div",{className:"misreservas__paginacion",children:[e.jsx("div",{className:"misreservas__pagina--button",children:e.jsx("p",{onClick:()=>S(l-1==0?l:l-1),children:"Previo"})}),s&&i.map(a=>e.jsx("div",{className:"misreservas__pagina",onClick:()=>S(a),children:e.jsx("p",{className:`${a==l?"active":""}`,children:a})},a)),e.jsx("div",{className:"misreservas__pagina--button",children:e.jsx("p",{onClick:()=>S(l+1>i.length?l:l+1),children:"Siguiente"})})]})}),e.jsx(I,{isSubmitted:m.isSubmitted,isGoodStatus:!m.existError,msg:m.msg,handleSubmit:_})]})}export{me as default};
