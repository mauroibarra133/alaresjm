import{r as h,R as k,a as Q,S as F,C as U,j as r,s as P,N as q,b as V,A as H,O as L,c as Y,u as W,P as K}from"./index-88797558.js";import{u as B}from"./useCart-da7075a8.js";import{g as X}from"./functions-7924356b.js";import{l as J,c as z,g as Z}from"./index-132df9d0.js";import{L as $}from"./LoaderComponent-ba3cad30.js";import{M as ee}from"./Modal-93689031.js";var M={};Object.defineProperty(M,"__esModule",{value:!0});var O=M.loadMercadoPago=void 0;const G="https://sdk.mercadopago.com/js/v2",te=/^https:\/\/sdk\.mercadopago\.com\/js\/v2\/?(\?.*)?$/,R="MercadoPago has already been initialized in your window, please remove the duplicate import",ne="MercadoPago.js not available",oe="Failed to load MercadoPago.js",ae=()=>{for(var i=document.querySelectorAll(`script[src^="${G}"`),s=0;s<i.length;s++){var t=i[s];if(te.test(t.src))return t}return null},re=()=>{const i=document.createElement("script");i.src=G;const s=document.head||document.body;if(!s)throw new Error("Expected document.body or document.head not to be null. MercadoPago requires a <body> or a <head> element, please add on your project.");return s.appendChild(i),i};let C=null;const ie=()=>(C!==null||(C=new Promise((i,s)=>{if(typeof window>"u"){i(null);return}if(window.MercadoPago){console.warn(R),i(window.MercadoPago);return}try{let t=ae();t?console.warn(R):t||(t=re()),t.addEventListener("load",()=>{window.MercadoPago?i(window.MercadoPago):s(new Error(ne))}),t.addEventListener("error",()=>{s(new Error(oe))})}catch(t){s(t);return}})),C);O=M.loadMercadoPago=ie;var se=globalThis&&globalThis.__awaiter||function(i,s,t,o){function d(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function u(e){try{c(o.next(e))}catch(l){a(l)}}function f(e){try{c(o.throw(e))}catch(l){a(l)}}function c(e){e.done?n(e.value):d(e.value).then(u,f)}c((o=o.apply(i,s||[])).next())})};class w{static getInstance(){return se(this,void 0,void 0,function*(){if(this.publicKey)return this.loadedInstanceMercadoPago||(yield O(),this.loadedInstanceMercadoPago=!0),this.instanceMercadoPago||(this.instanceMercadoPago=new window.MercadoPago(this.publicKey,this.options)),this.instanceMercadoPago;console.error("Expected the PUBLIC_KEY to render the MercadoPago SDK React")})}}w.publicKey=null;w.options={};w.instanceMercadoPago=void 0;w.loadedInstanceMercadoPago=!1;function ce(i,s){return Object.keys(i).length===Object.keys(s).length&&Object.keys(i).every(o=>Object.prototype.hasOwnProperty.call(s,o)&&i[o]===s[o])}const le=(i,s)=>{const t=Object.assign(Object.assign({},s),{frontEndStack:"react"}),o=!ce(w.options,t);(i!==w.publicKey||o)&&(w.publicKey=i,w.options=t,w.instanceMercadoPago=void 0)},de=200;var ue=globalThis&&globalThis.__awaiter||function(i,s,t,o){function d(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function u(e){try{c(o.next(e))}catch(l){a(l)}}function f(e){try{c(o.throw(e))}catch(l){a(l)}}function c(e){e.done?n(e.value):d(e.value).then(u,f)}c((o=o.apply(i,s||[])).next())})};const fe=()=>ue(void 0,void 0,void 0,function*(){}),me=()=>{},pe=i=>{console.error(i)};var he=globalThis&&globalThis.__awaiter||function(i,s,t,o){function d(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function u(e){try{c(o.next(e))}catch(l){a(l)}}function f(e){try{c(o.throw(e))}catch(l){a(l)}}function c(e){e.done?n(e.value):d(e.value).then(u,f)}c((o=o.apply(i,s||[])).next())})};const Ae=({settings:i,name:s,divId:t,controller:o})=>he(void 0,void 0,void 0,function*(){const d=yield w.getInstance(),n=d==null?void 0:d.bricks();window[o]=yield n==null?void 0:n.create(s,t,i)}),ge=({onReady:i=me,onError:s=pe,onSubmit:t=fe,customization:o,initialization:d,locale:n})=>(h.useEffect(()=>{let a;const u={settings:{initialization:d,customization:o,locale:n,callbacks:{onReady:i,onSubmit:t,onError:s}},name:"wallet",divId:"walletBrick_container",controller:"walletBrickController"};return a=setTimeout(()=>{Ae(u)},de),()=>{var f;clearTimeout(a),(f=window.walletBrickController)===null||f===void 0||f.unmount()}},[o,d,i,s,t]),k.createElement("div",{id:"walletBrick_container"}));globalThis&&globalThis.__awaiter;globalThis&&globalThis.__awaiter;globalThis&&globalThis.__awaiter;globalThis&&globalThis.__awaiter;globalThis&&globalThis.__awaiter;globalThis&&globalThis.__awaiter;globalThis&&globalThis.__awaiter;async function we(i,s,t,o,d,n){try{return await Q.post(`${F}/create_preference`,{items:i,address:s,extra:{tipoPago:t,tipoEntrega:o,notaPedido:d,user_id:n}},{headers:{"Content-Type":"application/json"}})}catch(a){throw console.error("Error al realizar la solicitud a Mercado Pago:",a),new U}}const be="data:image/webp;base64,UklGRvQAAABXRUJQVlA4WAoAAAAQAAAAHQAAHQAAQUxQSJkAAAABkBCAbRg2ghIogWImgiIohiIo3vZHSRlExAQgXGyP3dp4yEnNmz23ZsR5yKDnqQ6cx/zPnuf1j98ZQE1MRVOAIwEdGTU3imbrG/Y37ZMlFVCS+uQ5CnHfdabD+DAtqYCS1HN0n/4VoImb32h/s5ejBjoDKhpx4gKWo1sAqHf7H/AV8X++aZz5gkjLN97IF52YuF+L7bGbGyEAVlA4IDQAAAAwAwCdASoeAB4APxF4s1IsJySisBgIAYAiCWIAyNQYTVHAAP7wakt6paUE4s2QbCb1lAAA",xe="data:image/webp;base64,UklGRsAAAABXRUJQVlA4WAoAAAAQAAAAEwAAEwAAQUxQSFoAAAABYAhJkqRGWZRBGZNGGZRDaZT75kOIiAlASuqWwtE03aVY8G4z4T0kALvHDmgm+L1osXFpQ3ca+B8OThrJrWSoayNsw881E+AzA8AJAeCwR+SuSob6eOiWSKRWUDggQAAAAHADAJ0BKhQAFAA+6W6vUikmJCKoCAEgHQllAL9xwFkADdxwAAD+8USVIyDev6A76NpWwvHHhg5avxgpa43QAAA=";function ye({id:i,nombre:s,preciogrande:t,preciochico:o,descripcion:d,quantity:n,priceSelected:a,addToCart:u,removeProductFromCart:f}){let c;const{setPriceSelected:e}=B(),l=h.useId(),A=b=>{c=b.target.value,e(i,c==="Grande"?t:o,c==="Grande"?3:1)};return r.jsxs("div",{className:"order__item",children:[r.jsxs("div",{className:"order__item-r1",children:[r.jsx("p",{className:"order__name",children:s.toUpperCase()}),r.jsxs("select",{value:a==t?"Grande":"Chico",onChange:A,name:l,id:l,className:"order__item-selectsize",children:[t!=0&&r.jsx("option",{value:"Grande",disabled:t==0,children:"Grande"}),o!=0&&r.jsx("option",{value:"Chico",disabled:o==0,children:"Chico"})]}),r.jsx("p",{className:"order__price",children:`$${a*n}`})]}),r.jsxs("div",{className:"order__item-r2",children:[r.jsx("p",{className:"order__desc",children:d.toUpperCase()}),r.jsxs("div",{className:"order__buttons",children:[r.jsx("img",{src:be,alt:"Sumar Item",onClick:u}),r.jsx("p",{children:n}),r.jsx("img",{src:xe,alt:"Restar item",onClick:f})]})]})]})}function _e(){return r.jsxs(je,{children:[r.jsx(ve,{children:" El carrito está vacio"}),r.jsx(Ee,{to:"/carta",children:r.jsx(Se,{className:"button",children:"Ver Carta"})})]})}const je=P.div`
    width: 100%;
    display:flex;
    flex-direction: column;
    justify-content: center;
    gap: 1rem;
    padding: 1rem;
`,ve=P.p`
    text-align: center;
`,Ee=P(q)`
    width: 100%;
    display: flex;
    justify-content: center;
`,Se=P.button`
    display: flex;
    width: fit-content;
    height: 2rem;
    padding: 0.5rem 1rem;
    justify-content: center;
    align-items: center;
    border-radius: 2rem;
    text-align: center;
    font-size: 0.8125rem;
    font-family: 'Amiri';
    font-weight: 400;
    line-height: 1.5rem;
    letter-spacing: 0.00163rem;
    text-transform: uppercase;
    border: none;
    background-color: var(--gray-1);

    &:hover{
    cursor: pointer;
    transform: scale(1.1);
    background-color: var(--gray-3);
}
`;function Ie({onSubmit:i,total:s,preferenceId:t,isOrderedEft:o,loading:d,isTrashed:n,setTrashStatus:a}){var j,v,E,S,I;const u=h.useId(),f=h.useId(),c=h.useId(),e=h.useId(),l=h.useId(),{register:A,watch:b,formState:N,handleSubmit:D,reset:_}=V({mode:"onTouched",defaultValues:{notaPedido:"",direccionCliente:"",montoEft:"",tipoEntrega:"1"}}),{errors:g}=N;return h.useEffect(()=>{o.isSubmitted&&_()},[o.isSubmitted,_]),h.useEffect(()=>{n&&(_({notaPedido:"",direccionCliente:"",montoEft:""}),a())},[n]),r.jsxs("form",{className:"form-container",onSubmit:D(i),children:[r.jsxs("div",{className:"order__note-container",children:[r.jsx("label",{htmlFor:l,children:"Nota de pedido"}),r.jsx("textarea",{name:l,id:l,cols:"30",rows:"5",placeholder:"Por ej: quiero la hamburguesa sin lechuga y las papas sin panceta",...A("notaPedido")})]}),r.jsxs("div",{className:"order__form",children:[r.jsxs("div",{className:"form__row",children:[r.jsx("label",{htmlFor:e,children:"Tipo Entrega"}),r.jsxs("select",{name:e,id:e,...A("tipoEntrega",{required:"Debes incluir como sera entregado"}),children:[r.jsx("option",{value:"1",children:"Delivery"}),r.jsx("option",{value:"2",children:"Retirar en el local"})]})]}),r.jsxs("div",{className:"form__row",children:[r.jsx("label",{htmlFor:u,children:"Direccion"}),r.jsxs("div",{children:[r.jsx("input",{type:"text",id:u,...A("direccionCliente",{required:"Debes incluir la direccion",disabled:b("tipoEntrega")!=="1",pattern:H})}),((j=g.direccionCliente)==null?void 0:j.type)==="pattern"&&r.jsx("p",{role:"alert",className:"form-error input-error",children:"Algunos caracteres no estan permitidos"}),((v=g.direccionCliente)==null?void 0:v.type)==="required"&&r.jsx("p",{role:"alert",className:"form-error input-error",children:g.direccionCliente.message})]})]}),r.jsxs("div",{className:"form__row",children:[r.jsx("label",{htmlFor:f,children:"Tipo Pago"}),r.jsxs("select",{name:f,id:f,...A("tipoPago",{required:"Debes incluir como pagar tu pedido"}),children:[r.jsx("option",{value:"1",children:"Efectivo"}),r.jsx("option",{value:"2",disabled:!0,children:"Transferencia"})]})]}),r.jsxs("div",{className:"form__row",children:[r.jsx("label",{htmlFor:c,children:"Abono con"}),r.jsxs("div",{children:[r.jsx("input",{type:"text",id:c,...A("montoEft",{required:"Debes incluir con cuanto efectivo nos pagas.",disabled:b("tipoPago")==="2",pattern:{value:L,message:"Solo se permiten números"},validate:m=>{const p=parseInt(m);if(p>=s*2)return"El monto no puede ser tan grande";if(p<s)return"El monto a pagar debe ser superior al total"}})}),((E=g.montoEft)==null?void 0:E.type)==="required"&&r.jsx("p",{role:"alert",className:"form-error input-error",children:g.montoEft.message}),((S=g.montoEft)==null?void 0:S.type)==="pattern"&&r.jsx("p",{role:"alert",className:"form-error input-error",children:g.montoEft.message}),((I=g.montoEft)==null?void 0:I.type)==="validate"&&r.jsx("p",{role:"alert",className:"form-error input-error",children:g.montoEft.message})]})]})]}),r.jsxs("div",{className:"order__button",children:[r.jsx("button",{type:"submit",className:"order__confirmar button",disabled:s==0,children:d?r.jsx($,{size:"small",color:"mp-color"}):"Confirmar pedido"}),t&&b("tipoPago")==="2"&&r.jsx(ge,{initialization:{preferenceId:t,redirectMode:"modal"},className:"button mp_button"})]})]})}const Te="data:image/webp;base64,UklGRh4DAABXRUJQVlA4WAoAAAAQAAAAfwAAfwAAQUxQSLICAAABGTJp2xDb20T0P9iqfh6QNNu2aT37i23bdlpfunbST9Pmn0jPTrpu2Wzatnn57Hc+3O9crH2eqr6qiAlw4DaSIrl3e2+5jukHlDTGqPGWm26QtlzFfHXDUS8poqUdpvEaKOegrdKUGM/wk+mWuVQYdvIXaq8NFNijmj85E73C3nJ+Y+2wFXsz+PXSeOwN4FdEB+y100AVV4IkjzJVcmuuvyGGGGuMIQaRXU/PZfnstVc+++yNOEb6GGOIIYYYa4jA0/7xymefffbaWzlQndXf0EOMRqCV8cNn9XfDV3mBH6/+Ph6OMKqUX+ofC6/9FhgTYVfBPyfLVqRgqkIqARXTRlICSUpISiA+T5CQxJZmoFY6CyphQLdPXErwAkwY0O3z2FSB07G7GwFBiw0dKbwzFb/FtozmWMmxBU8w9MJrTR74nvphi2vIdNuN5OHrzCHHvUTGWWqllhz85dSBnyk/TGIi5Ixqz/Tn5pf5niGE3LPRJBf0VT96yimFbVuYHF+otznN7bJjJIQ8tcBdLdXxl1MDdg1x1FXExSF1Y4PhiPXqeMopA55JcQpzc4w0guuPX05JhE1rw+Oz9jXpr30ek7fFR1vEmyhpBP78F0u6YBW+poM0oQojAkSWrTPJb70o7UiEZBDMLKOmAX1UUp6mmNCRwry4DJjBv+6pf6BCLy6OjwSBgCZ8aAiITnmawqGF5jBaIAyAJ23h6fjQqdqKwEzxaDq8duBvuyi2DC4tKwpFMKDB5wnRoUnnYSvYNOVp1FfCLUa/7hWQmRJuN4EHwYKTZePBBv23DEw2j1/RguCJ4OQnEQiTyHz8p7x3eHgN6Q4ZRcM/8gAHd2FDb5DVDFzWVlj3rHFYFTBhNQKuoxY7qgeof1Yg8DpvqGWWGK2HKpjt/3vtjAsIg4rahTRqLwJWUDggRgAAAHAGAJ0BKoAAgAA+kUihTKWkIyIgiACwEglpbuF0kABPbYi8QVHPbEXiCo57Yi8QVHPbEXiCo57Yi8QTYAD+/1JPYoAAAAA=",Ce=J("/");function Oe(){le("APP_USR-aaad6c69-62aa-4d6b-a9fd-e744881e088a");const[i,s]=h.useState(0),[t,o]=h.useState(null),[d,n]=h.useState(null),[a,u]=h.useState({isSubmitted:!1,goodStatus:!1}),[f,c]=h.useState(!1),e=Y(),{auth:l}=W(),{cart:A,clearCart:b,addToCart:N,removeProductFromCart:D,modifyCart:_}=B();h.useEffect(()=>{new URLSearchParams(window.location.search).get("collection_status")&&b()},[]),h.useEffect(()=>{(()=>{const p=A.reduce((x,y)=>x+y.priceSelected*y.quantity,0);s(p)})()},[A]);function g(){u({isSubmitted:!1,goodStatus:!1}),e("/home/success")}async function j({direccionCliente:m,tipoPago:p,tipoEntrega:x,notaPedido:y}){try{return await we(_(A),m,p,x,y,l.data.user_id)}catch(T){return T}}const v=async m=>{if(m.tipoPago=="2")try{const p=await j(m),x=p.data.response.id;console.log("Preference ID traido: ",p),x&&(console.log("ID",x),o(x))}catch{u({isSubmitted:!0,goodStatus:!1})}else try{const p=new Date,x=p.toISOString(),y=await z(x,l.data.user_id,m.direccionCliente,m.notaPedido,parseInt(m.total),parseInt(m.tipoPago),parseInt(m.tipoEntrega),parseInt(m.montoEft),_(A));if(y.status>=200&&y.status<300){const T=await Z({date:p});Ce.emit("newOrder",T.data.data[0]),u({isSubmitted:!0,goodStatus:!0}),b()}}catch(p){u({isSubmitted:!0,goodStatus:!1}),console.log(p)}c(!1)},E=m=>{c(!0);const p={...m,carritoItems:A,total:i};v(p)};function S(){n(!0),b()}function I(){n(!1)}return r.jsx(r.Fragment,{children:r.jsxs("div",{className:"delivery__container",children:[r.jsx(K,{pathPrev:"Home",pathActual:"Delivery",goTo:"Home"}),r.jsxs("div",{className:"order__container",children:[r.jsx("div",{className:"order__items",children:A.length===0?r.jsx(_e,{}):A.map(m=>r.jsx(ye,{...m,addToCart:()=>N(m),removeProductFromCart:()=>D(m)},X()))}),r.jsxs("div",{className:"order__total",children:[r.jsx("p",{className:"order__total-name",children:"TOTAL"}),r.jsx("p",{className:"order__total-price",children:`$${i}`})]}),r.jsx("div",{className:"order__button",children:r.jsx("button",{className:"button delete_cart_button",onClick:S,children:r.jsx("img",{src:Te,alt:"Trash Button"})})})]}),r.jsx(Ie,{onSubmit:E,total:i,preferenceId:t,isOrderedEft:a,loading:f,setTrashStatus:I,isTrashed:d}),a.isSubmitted&&r.jsx(ee,{isSubmitted:a.isSubmitted,handleSubmit:g,isGoodStatus:a.goodStatus,position:"top",msg:a.goodStatus?"Tu pedido ha sido realizado correctamente!":"Tu pedido no pudo ser procesado, intente nuevamente!"})]})})}export{Oe as default};
