import{r as n,b as q,j as e,v as B,o as z,k as D,q as C,x as A,y as P,z as H,B as L,D as V,F as k,G as O,u as U,H as M,P as $}from"./index-39b704a7.js";import{e as W}from"./eye-slash-d3ee0e19.js";import{F as R}from"./FormVacio-fe129911.js";import{u as Z,d as Y,g as J}from"./reservas.services-228d6422.js";import{p as K}from"./pencil-solid-d38e41d0.js";import{c as G}from"./xmark-solid-4f97102d.js";import{M as I}from"./Modal-58cfa6eb.js";function Q({showModalUpdate:r,reserva:a,handleCloseModalUpdate:m}){var t,d,s,l,p,S,E;const c=n.useId(),g=n.useId(),x=n.useId(),j=new Date(a.fecha).toISOString().split("T")[0],{register:o,handleSubmit:N,formState:h,setValue:b}=q({mode:"onBlur"}),[f,v]=n.useState({isSubmitted:!1,isGood:!1,msg:""}),{errors:i}=h;function y(){f.isGood?(v({isSubmitted:!1,isGood:!1,msg:""}),m()):v({isSubmitted:!1,isGood:!1,msg:""})}function _(u,T="Hubo un error al modificar tu reserva"){v({isSubmitted:!0,isGood:u,msg:u?"Tu reserva ha sido modificada correctamente":T})}async function w(u){if(u.cliente==a.cliente_reserva&&parseInt(u.comensales)==a.cantidad_personas&&u.fecha==j&&u.hora==a.hora&&u.zona==a.lugar)v({isSubmitted:!0,isGood:!1,msg:"No se ha modificado ningun campo"});else{if(!C(u.hora,u.fecha)){_(!1,"La hora ingresada es antigua");return}(await Z(a.id,{...u,estado:"A Confirmar"})).status===200?_(!0):_(!1)}}return n.useEffect(()=>{b("zona",a.lugar)}),e.jsx(e.Fragment,{children:r&&e.jsxs("div",{className:"modal-modificar",children:[e.jsx("h1",{children:"Modificar Datos"}),e.jsx("img",{className:"modal-closebutton",src:G,alt:"Close Button",onClick:m}),e.jsx("div",{className:"modal-modificar__container",children:e.jsxs("form",{className:"reservas__form",onSubmit:N(w),children:[e.jsxs("div",{className:"reservas__row",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Fecha"}),e.jsx("input",{type:"date",defaultValue:j,...o("fecha",{required:!0,validate:B})})]}),((t=i.fecha)==null?void 0:t.type)==="required"&&e.jsx("p",{role:"alert",className:"form-error",children:"La fecha es requerida."}),((d=i.fecha)==null?void 0:d.type)==="validate"&&e.jsx("p",{role:"alert",className:"form-error",children:"La fecha es pasada."})]}),e.jsxs("div",{className:"reservas__row",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Hora"}),e.jsx("input",{type:"time",defaultValue:a.hora,...o("hora",{required:!0,validate:z})})]}),((s=i.hora)==null?void 0:s.type)==="required"&&e.jsx("p",{role:"alert",className:"form-error",children:"La hora es requerida."}),((l=i.hora)==null?void 0:l.type)==="validate"&&e.jsx("p",{role:"alert",className:"form-error",children:"Debe ser entre las 19:00hs y 23:00hs."})]}),e.jsxs("div",{className:"reservas__row",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:c,children:"Numero de comensales"}),e.jsx("input",{type:"number",id:c,defaultValue:a.cantidad_personas,...o("comensales",{required:!0})})]}),((p=i.comensales)==null?void 0:p.type)==="required"&&e.jsxs(e.Fragment,{children:[e.jsx("p",{role:"alert",className:"form-error",children:"La cantidad de comensales"}),e.jsx("p",{role:"alert",className:"form-error",children:" es requerida."})]})]}),e.jsx("div",{className:"reservas__row",children:e.jsxs("div",{children:[e.jsx("label",{htmlFor:g,children:"Zona a reservar"}),e.jsxs("select",{name:g,id:g,...o("zona",{required:!0}),children:[e.jsx("option",{value:"Terraza",children:"Terraza"}),e.jsx("option",{value:"Terraza Norte",children:"Terraza Norte"}),e.jsx("option",{value:"Salon",children:"Salon"}),e.jsx("option",{value:"Patio",children:"Patio"})]})]})}),e.jsxs("div",{className:"reservas__row",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:x,children:"A nombre de"}),e.jsx("input",{type:"text",name:x,id:x,defaultValue:a.cliente_reserva,...o("cliente",{required:!0,pattern:D})})]}),((S=i.cliente)==null?void 0:S.type)==="required"&&e.jsx("p",{role:"alert",className:"form-error",children:"El nombre es requerido"}),((E=i.cliente)==null?void 0:E.type)==="pattern"&&e.jsx("p",{role:"alert",className:"form-error",children:"El nombre solo debe incluir letras"})]}),e.jsx("div",{className:"button__wrapper",children:e.jsx("button",{className:"button",type:"submit",children:"ACTUALIZAR"})})]})}),e.jsx(I,{isSubmitted:f.isSubmitted,isGoodStatus:f.isGood,handleSubmit:y,msg:f.msg,offset:-120})]})})}const X=[{status:"A Confirmar",img:V},{status:"Reservado",img:k},{status:"Cancelado",img:O}];function F({booking:r,fechaHoy:a}){const m=new Date(r.fecha).toISOString().split("T")[0],c=1,[g,x]=n.useState(window.innerWidth>768),[j,o]=n.useState({isClicked:!1,isGood:!1,msg:""}),[N,h]=n.useState(!1);function b(t){const d=X.find(s=>s.estado===t);return d?d.img:null}function f(){o({isClicked:!1,isGood:!1})}function v(){h(!1)}function i(t,d){o({isClicked:!0,isGood:t,msg:d})}async function y(){if(m>=a){const t=H(r.hora);L(t)>=c?(await Y(r.id)).status==200?i(!0,"Reserva cancelada correctamente"):i(!1,"Hubo un error al eliminar su reserva, intente mas tarde"):i(!1,`No se puede cancelar la reserva faltando menos de ${c} hora/s`)}}async function _(){if(m==a){const t=H(r.hora);L(t)>=c?h(!0):i(!1,`No se puede modificar la reserva faltando menos de ${c} hora/s`)}else m>a&&h(!0)}const w=`${m.substring(8,10)}/${m.substring(5,7)}`;return n.useEffect(()=>{const t=()=>{x(window.innerWidth>768)};return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}},[]),e.jsxs("div",{className:"datos__body-row",children:[e.jsx("div",{className:"datos__body-dato",children:w}),e.jsx("div",{className:"datos__body-dato",children:r.hora}),e.jsxs("div",{className:"datos__body-dato datos__body-comensales",children:[e.jsx("img",{src:A,className:"user-icon",alt:"Cantidad de personas"}),r.cantidad_personas]}),e.jsx("div",{className:"datos__body-dato",children:r.lugar}),e.jsxs("div",{className:"datos__body-dato",children:[e.jsx("img",{src:b(),alt:r.estado,className:"status-img"}),g&&e.jsx("p",{children:r.estado})]}),e.jsxs("div",{className:"datos__body-dato acciones",children:[e.jsx("img",{src:K,alt:"Modificar",className:C(r.hora,m)?"new":"old",onClick:()=>_()}),e.jsx("img",{src:G,alt:"Eliminar",className:C(r.hora,m)?"new":"old",onClick:()=>y()})]}),e.jsx(I,{isSubmitted:j.isClicked,isGoodStatus:j.isGood,handleSubmit:f,msg:j.msg,position:"top"}),N&&e.jsx(P,{comp:"reserva",children:e.jsx(Q,{showModalUpdate:N,reserva:r,handleCloseModalUpdate:v})})]},r.id)}function ne(){const{auth:r}=U(),[a,m]=n.useState([]),[c,g]=n.useState(!0),[x,j]=n.useState({isSubmitted:!1,existError:!1,msg:""}),[o,N]=n.useState(1),[h,b]=n.useState(0),[f,v]=n.useState([]),i=6,y=new Date().toISOString().split("T")[0];n.useEffect(()=>{async function s(){if(r.data.user_id)return(await J({user_id:r.data.user_id})).data}s().then(l=>m(l.data)).catch()},[r.data.user_id]),n.useEffect(()=>{const s=[];for(let l=1;l<=Math.ceil((d().length==0?1:d().length)/i);l++)s.push(l);v(s),t(1)},[a,c]);function _(){const l=M(new Date);if(a.length<=0)return e.jsx(R,{msg:"Aun no tienes ninguna reserva hoy",msgButton:"RESERVAR",goTo:"reservas"});if(c){const p=d();return p.length>0?p.slice(h,i+h).map(S=>e.jsx(F,{booking:S,fechaHoy:l},S.id)):e.jsx(R,{msg:"Aun no tienes ninguna reserva hoy",msgButton:"RESERVAR",goTo:"reservas"})}else return a.length>0?d().slice(h,i+h).map(p=>{const S=p.fecha,u=new Date(S).toLocaleDateString();return e.jsx(F,{fechaLegible:u,booking:p,fechaHoy:l},p.id)}):e.jsx(R,{msg:"Aun no tienes ninguna reserva hoy",msgButton:"RESERVAR",goTo:"reservas"})}function w(){j({isSubmitted:!1,existError:!1,msg:""}),document.body.classList.remove("disable-scroll")}function t(s){s!==o&&(window.scrollTo(0,10),N(s),b((s-1)*i))}function d(){if(a.length<=0)return[];if(c){const s=a.filter(l=>{if(M(l.fecha)>=M(y))return l});return s.length<=0?[]:s}else return a}return e.jsxs("div",{className:"misreservas__container",children:[e.jsx($,{pathPrev:"Home",pathActual:"Mis Reservas",goTo:"home"}),e.jsxs("div",{className:"misreservas__form",children:[e.jsxs("div",{className:"misreservas__filter",onClick:()=>g(!c),children:[e.jsx("img",{src:W,alt:"Icono de oculto"}),e.jsx("p",{children:c?"Mostrar reservas antiguas":"Ocultar reservas antiguas"})]}),e.jsxs("div",{className:"misreservas__datos",children:[e.jsxs("div",{className:"datos__header",children:[e.jsx("p",{className:"datos__header-column",children:"Fecha"}),e.jsx("p",{className:"datos__header-column",children:"Hora"}),e.jsx("p",{className:"datos__header-column",children:"Comens."}),e.jsx("p",{className:"datos__header-column",children:"Lugar"}),e.jsx("p",{className:"datos__header-column",children:"Estado"}),e.jsx("p",{className:"datos__header-column",children:"Acciones"})]}),e.jsx("div",{className:"datos__body",children:_()})]})]}),f.length>1&&e.jsx("div",{className:"misreservas__paginacion-wrapper",children:e.jsxs("div",{className:"misreservas__paginacion",children:[e.jsx("div",{className:"misreservas__pagina--button",children:e.jsx("p",{onClick:()=>t(o-1==0?o:o-1),children:"Previo"})}),a&&f.map(s=>e.jsx("div",{className:"misreservas__pagina",onClick:()=>t(s),children:e.jsx("p",{className:`${s==o?"active":""}`,children:s})},s)),e.jsx("div",{className:"misreservas__pagina--button",children:e.jsx("p",{onClick:()=>t(o+1>f.length?o:o+1),children:"Siguiente"})})]})}),e.jsx(I,{isSubmitted:x.isSubmitted,isGoodStatus:!x.existError,msg:x.msg,handleSubmit:w})]})}export{ne as default};
