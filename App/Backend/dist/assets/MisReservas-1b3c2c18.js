import{r as n,b as B,j as e,v as q,o as z,k as A,p as C,w as D,x as P,y as L,z as H,B as V,D as k,F as O,u as U,G as M,P as $}from"./index-183b0b0a.js";import{e as W}from"./eye-slash-d3ee0e19.js";import{F as R}from"./FormVacio-e22c76e3.js";import{u as Z,d as Y,g as J}from"./reservas.services-5d9941cf.js";import{p as K}from"./pencil-solid-d38e41d0.js";import{c as G}from"./xmark-solid-4f97102d.js";import{M as I}from"./Modal-24a39e88.js";function Q({showModalUpdate:r,reserva:s,handleCloseModalUpdate:c}){var t,d,a,l,x,S,E;const u=n.useId(),g=n.useId(),f=n.useId(),j=new Date(s.fecha).toISOString().split("T")[0],{register:o,handleSubmit:N,formState:h,setValue:b}=B({mode:"onBlur"}),[p,v]=n.useState({isSubmitted:!1,isGood:!1,msg:""}),{errors:i}=h;function y(){p.isGood?(v({isSubmitted:!1,isGood:!1,msg:""}),c()):v({isSubmitted:!1,isGood:!1,msg:""})}function _(m,T="Hubo un error al modificar tu reserva"){v({isSubmitted:!0,isGood:m,msg:m?"Tu reserva ha sido modificada correctamente":T})}async function w(m){if(m.cliente==s.cliente_reserva&&parseInt(m.comensales)==s.cantidad_personas&&m.fecha==j&&m.hora==s.hora&&m.zona==s.lugar)v({isSubmitted:!0,isGood:!1,msg:"No se ha modificado ningun campo"});else{if(!C(m.hora,m.fecha)){_(!1,"La hora ingresada es antigua");return}(await Z(s.id,{...m,estado:"A Confirmar"})).status===200?_(!0):_(!1)}}return n.useEffect(()=>{b("zona",s.lugar)}),e.jsx(e.Fragment,{children:r&&e.jsxs("div",{className:"modal-modificar",children:[e.jsx("h1",{children:"Modificar Datos"}),e.jsx("img",{className:"modal-closebutton",src:G,alt:"Close Button",onClick:c}),e.jsx("div",{className:"modal-modificar__container",children:e.jsxs("form",{className:"reservas__form",onSubmit:N(w),children:[e.jsxs("div",{className:"reservas__row",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Fecha"}),e.jsx("input",{type:"date",defaultValue:j,...o("fecha",{required:!0,validate:q})})]}),((t=i.fecha)==null?void 0:t.type)==="required"&&e.jsx("p",{role:"alert",className:"form-error",children:"La fecha es requerida."}),((d=i.fecha)==null?void 0:d.type)==="validate"&&e.jsx("p",{role:"alert",className:"form-error",children:"La fecha es pasada."})]}),e.jsxs("div",{className:"reservas__row",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Hora"}),e.jsx("input",{type:"time",defaultValue:s.hora,...o("hora",{required:!0,validate:z})})]}),((a=i.hora)==null?void 0:a.type)==="required"&&e.jsx("p",{role:"alert",className:"form-error",children:"La hora es requerida."}),((l=i.hora)==null?void 0:l.type)==="validate"&&e.jsx("p",{role:"alert",className:"form-error",children:"Debe ser entre las 19:00hs y 23:00hs."})]}),e.jsxs("div",{className:"reservas__row",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:u,children:"Numero de comensales"}),e.jsx("input",{type:"number",id:u,defaultValue:s.cantidad_personas,...o("comensales",{required:!0})})]}),((x=i.comensales)==null?void 0:x.type)==="required"&&e.jsxs(e.Fragment,{children:[e.jsx("p",{role:"alert",className:"form-error",children:"La cantidad de comensales"}),e.jsx("p",{role:"alert",className:"form-error",children:" es requerida."})]})]}),e.jsx("div",{className:"reservas__row",children:e.jsxs("div",{children:[e.jsx("label",{htmlFor:g,children:"Zona a reservar"}),e.jsxs("select",{name:g,id:g,...o("zona",{required:!0}),children:[e.jsx("option",{value:"Terraza",children:"Terraza"}),e.jsx("option",{value:"Terraza Norte",children:"Terraza Norte"}),e.jsx("option",{value:"Salon",children:"Salon"}),e.jsx("option",{value:"Patio",children:"Patio"})]})]})}),e.jsxs("div",{className:"reservas__row",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:f,children:"A nombre de"}),e.jsx("input",{type:"text",name:f,id:f,defaultValue:s.cliente_reserva,...o("cliente",{required:!0,pattern:A})})]}),((S=i.cliente)==null?void 0:S.type)==="required"&&e.jsx("p",{role:"alert",className:"form-error",children:"El nombre es requerido"}),((E=i.cliente)==null?void 0:E.type)==="pattern"&&e.jsx("p",{role:"alert",className:"form-error",children:"El nombre solo debe incluir letras"})]}),e.jsx("div",{className:"button__wrapper",children:e.jsx("button",{className:"button",type:"submit",children:"ACTUALIZAR"})})]})}),e.jsx(I,{isSubmitted:p.isSubmitted,isGoodStatus:p.isGood,handleSubmit:y,msg:p.msg,offset:-120})]})})}const X=[{status:"A Confirmar",img:V},{status:"Reservado",img:k},{status:"Cancelado",img:O}];function F({booking:r,fechaHoy:s}){const c=new Date(r.fecha).toISOString().split("T")[0],u=1,[g,f]=n.useState(window.innerWidth>768),[j,o]=n.useState({isClicked:!1,isGood:!1,msg:""}),[N,h]=n.useState(!1);function b(t){const d=X.find(a=>a.estado===t);return d?d.img:null}function p(){o({isClicked:!1,isGood:!1})}function v(){h(!1)}function i(t,d){o({isClicked:!0,isGood:t,msg:d})}async function y(){if(c>=s){const t=L(r.hora);H(t)>=u?(console.log("Se puede modificar"),(await Y(r.id)).status==200?i(!0,"Reserva cancelada correctamente"):i(!1,"Hubo un error al eliminar su reserva, intente mas tarde")):(console.log("Es muy tarde"),i(!1,`No se puede cancelar la reserva faltando menos de ${u} hora/s`))}}async function _(){if(console.log(c,s),c==s){const t=L(r.hora);H(t)>=u?(console.log("Se puede modificar"),h(!0)):(console.log("Es muy tarde"),i(!1,`No se puede modificar la reserva faltando menos de ${u} hora/s`))}else c>s&&h(!0)}const w=`${c.substring(8,10)}/${c.substring(5,7)}`;return n.useEffect(()=>{const t=()=>{f(window.innerWidth>768)};return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}},[]),e.jsxs("div",{className:"datos__body-row",children:[e.jsx("div",{className:"datos__body-dato",children:w}),e.jsx("div",{className:"datos__body-dato",children:r.hora}),e.jsxs("div",{className:"datos__body-dato datos__body-comensales",children:[e.jsx("img",{src:D,className:"user-icon",alt:"Cantidad de personas"}),r.cantidad_personas]}),e.jsx("div",{className:"datos__body-dato",children:r.lugar}),e.jsxs("div",{className:"datos__body-dato",children:[e.jsx("img",{src:b(),alt:r.estado,className:"status-img"}),g&&e.jsx("p",{children:r.estado})]}),e.jsxs("div",{className:"datos__body-dato acciones",children:[e.jsx("img",{src:K,alt:"Modificar",className:C(r.hora,c)?"new":"old",onClick:()=>_()}),e.jsx("img",{src:G,alt:"Eliminar",className:C(r.hora,c)?"new":"old",onClick:()=>y()})]}),e.jsx(I,{isSubmitted:j.isClicked,isGoodStatus:j.isGood,handleSubmit:p,msg:j.msg,position:"top"}),N&&e.jsx(P,{comp:"reserva",children:e.jsx(Q,{showModalUpdate:N,reserva:r,handleCloseModalUpdate:v})})]},r.id)}function ne(){const{auth:r}=U(),[s,c]=n.useState([]),[u,g]=n.useState(!0),[f,j]=n.useState({isSubmitted:!1,existError:!1,msg:""}),[o,N]=n.useState(1),[h,b]=n.useState(0),[p,v]=n.useState([]),i=6,y=new Date().toISOString().split("T")[0];n.useEffect(()=>{async function a(){if(r.data.user_id)return(await J({user_id:r.data.user_id})).data}a().then(l=>c(l.data)).catch()},[r.data.user_id]),n.useEffect(()=>{const a=[];for(let l=1;l<=Math.ceil((d().length==0?1:d().length)/i);l++)a.push(l);v(a),t(1)},[s,u]);function _(){const l=M(new Date);if(s.length<=0)return e.jsx(R,{msg:"Aun no tienes ninguna reserva hoy",msgButton:"RESERVAR",goTo:"reservas"});if(u){const x=d();return x.length>0?x.slice(h,i+h).map(S=>e.jsx(F,{booking:S,fechaHoy:l},S.id)):e.jsx(R,{msg:"Aun no tienes ninguna reserva hoy",msgButton:"RESERVAR",goTo:"reservas"})}else return s.length>0?d().slice(h,i+h).map(x=>{const S=x.fecha,m=new Date(S).toLocaleDateString();return e.jsx(F,{fechaLegible:m,booking:x,fechaHoy:l},x.id)}):e.jsx(R,{msg:"Aun no tienes ninguna reserva hoy",msgButton:"RESERVAR",goTo:"reservas"})}function w(){j({isSubmitted:!1,existError:!1,msg:""}),document.body.classList.remove("disable-scroll")}function t(a){a!==o&&(window.scrollTo(0,10),N(a),b((a-1)*i))}function d(){if(s.length<=0)return[];if(u){const a=s.filter(l=>{if(M(l.fecha)>=M(y))return l});return a.length<=0?[]:a}else return s}return e.jsxs("div",{className:"misreservas__container",children:[e.jsx($,{pathPrev:"Home",pathActual:"Mis Reservas",goTo:"home"}),e.jsxs("div",{className:"misreservas__form",children:[e.jsxs("div",{className:"misreservas__filter",onClick:()=>g(!u),children:[e.jsx("img",{src:W,alt:"Icono de oculto"}),e.jsx("p",{children:u?"Mostrar reservas antiguas":"Ocultar reservas antiguas"})]}),e.jsxs("div",{className:"misreservas__datos",children:[e.jsxs("div",{className:"datos__header",children:[e.jsx("p",{className:"datos__header-column",children:"Fecha"}),e.jsx("p",{className:"datos__header-column",children:"Hora"}),e.jsx("p",{className:"datos__header-column",children:"Comens."}),e.jsx("p",{className:"datos__header-column",children:"Lugar"}),e.jsx("p",{className:"datos__header-column",children:"Estado"}),e.jsx("p",{className:"datos__header-column",children:"Acciones"})]}),e.jsx("div",{className:"datos__body",children:_()})]})]}),e.jsx("div",{className:"misreservas__paginacion-wrapper",children:e.jsxs("div",{className:"misreservas__paginacion",children:[e.jsx("div",{className:"misreservas__pagina--button",children:e.jsx("p",{onClick:()=>t(o-1==0?o:o-1),children:"Previo"})}),s&&p.map(a=>e.jsx("div",{className:"misreservas__pagina",onClick:()=>t(a),children:e.jsx("p",{className:`${a==o?"active":""}`,children:a})},a)),e.jsx("div",{className:"misreservas__pagina--button",children:e.jsx("p",{onClick:()=>t(o+1>p.length?o:o+1),children:"Siguiente"})})]})}),e.jsx(I,{isSubmitted:f.isSubmitted,isGoodStatus:!f.existError,msg:f.msg,handleSubmit:w})]})}export{ne as default};
