import{r as t,b as G,j as e,i as z,p as B,q as D,w as P,t as V,v as k,u as O,P as U}from"./index-d654d3f8.js";import{e as $}from"./eye-slash-d3ee0e19.js";import{F as I}from"./FormVacio-0ff088d2.js";import{v as Z,a as W,c as R,d as T,e as H,t as L}from"./functions-63fd6aa2.js";import{u as Y,d as J,g as K}from"./reservas.services-b5165cfe.js";import{p as Q}from"./pencil-solid-d38e41d0.js";import{c as A}from"./xmark-solid-4f97102d.js";import{M as C}from"./Modal-75e303a2.js";import{L as X}from"./LoaderComponent-d1f3c2e2.js";function ee({showModalUpdate:a,reserva:s,handleCloseModalUpdate:m}){var i,l,_,M,S,r,d;const u=t.useId(),g=t.useId(),f=t.useId(),p=new Date(s.fecha).toISOString().split("T")[0],{register:o,handleSubmit:N,formState:j,setValue:w}=G({mode:"onBlur"}),[h,v]=t.useState({isSubmitted:!1,isGood:!1,msg:""}),{errors:n}=j;function b(){h.isGood?(v({isSubmitted:!1,isGood:!1,msg:""}),m()):v({isSubmitted:!1,isGood:!1,msg:""})}function x(c,y="Hubo un error al modificar tu reserva"){v({isSubmitted:!0,isGood:c,msg:c?"Tu reserva ha sido modificada correctamente":y})}async function E(c){if(c.cliente==s.cliente_reserva&&parseInt(c.comensales)==s.cantidad_personas&&c.fecha==p&&c.hora==s.hora&&c.zona==s.lugar)v({isSubmitted:!0,isGood:!1,msg:"No se ha modificado ningun campo"});else{if(!R(c.hora,c.fecha)){x(!1,"La hora ingresada es antigua");return}(await Y(s.id,{...c,estado:"A Confirmar"})).status===200?x(!0):x(!1)}}return t.useEffect(()=>{w("zona",s.lugar)}),e.jsx(e.Fragment,{children:a&&e.jsxs("div",{className:"modal-modificar",children:[e.jsx("h1",{children:"Modificar Datos"}),e.jsx("img",{className:"modal-closebutton",src:A,alt:"Close Button",onClick:m}),e.jsx("div",{className:"modal-modificar__container",children:e.jsxs("form",{className:"reservas__form",onSubmit:N(E),children:[e.jsxs("div",{className:"reservas__row",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Fecha"}),e.jsx("input",{type:"date",defaultValue:p,...o("fecha",{required:!0,validate:Z})})]}),((i=n.fecha)==null?void 0:i.type)==="required"&&e.jsx("p",{role:"alert",className:"form-error",children:"La fecha es requerida."}),((l=n.fecha)==null?void 0:l.type)==="validate"&&e.jsx("p",{role:"alert",className:"form-error",children:"La fecha es pasada."})]}),e.jsxs("div",{className:"reservas__row",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"",children:"Hora"}),e.jsx("input",{type:"time",defaultValue:s.hora,...o("hora",{required:!0,validate:W})})]}),((_=n.hora)==null?void 0:_.type)==="required"&&e.jsx("p",{role:"alert",className:"form-error",children:"La hora es requerida."}),((M=n.hora)==null?void 0:M.type)==="validate"&&e.jsx("p",{role:"alert",className:"form-error",children:"Debe ser entre las 19:00hs y 23:00hs."})]}),e.jsxs("div",{className:"reservas__row",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:u,children:"Numero de comensales"}),e.jsx("input",{type:"number",id:u,defaultValue:s.cantidad_personas,...o("comensales",{required:!0})})]}),((S=n.comensales)==null?void 0:S.type)==="required"&&e.jsxs(e.Fragment,{children:[e.jsx("p",{role:"alert",className:"form-error",children:"La cantidad de comensales"}),e.jsx("p",{role:"alert",className:"form-error",children:" es requerida."})]})]}),e.jsx("div",{className:"reservas__row",children:e.jsxs("div",{children:[e.jsx("label",{htmlFor:g,children:"Zona a reservar"}),e.jsxs("select",{name:g,id:g,...o("zona",{required:!0}),children:[e.jsx("option",{value:"Terraza",children:"Terraza"}),e.jsx("option",{value:"Terraza Norte",children:"Terraza Norte"}),e.jsx("option",{value:"Salon",children:"Salon"}),e.jsx("option",{value:"Patio",children:"Patio"})]})]})}),e.jsxs("div",{className:"reservas__row",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:f,children:"A nombre de"}),e.jsx("input",{type:"text",name:f,id:f,defaultValue:s.cliente_reserva,...o("cliente",{required:!0,pattern:z})})]}),((r=n.cliente)==null?void 0:r.type)==="required"&&e.jsx("p",{role:"alert",className:"form-error",children:"El nombre es requerido"}),((d=n.cliente)==null?void 0:d.type)==="pattern"&&e.jsx("p",{role:"alert",className:"form-error",children:"El nombre solo debe incluir letras"})]}),e.jsx("div",{className:"button__wrapper",children:e.jsx("button",{className:"button",type:"submit",children:"ACTUALIZAR"})})]})}),h.isSubmitted&&e.jsx(C,{isSubmitted:h.isSubmitted,isGoodStatus:h.isGood,handleSubmit:b,msg:h.msg,offset:-120})]})})}const se=[{status:"A Confirmar",img:P},{status:"Reservado",img:V},{status:"Cancelado",img:k}];function ae({booking:a,fechaHoy:s}){const m=new Date(a.fecha).toISOString().split("T")[0],u=1,[g,f]=t.useState(window.innerWidth>768),[p,o]=t.useState({isClicked:!1,isGood:!1,msg:""}),[N,j]=t.useState(!1);function w(i){const l=se.find(_=>_.status===i);return l?l.img:null}function h(){o({isClicked:!1,isGood:!1})}function v(){j(!1)}function n(i,l){o({isClicked:!0,isGood:i,msg:l})}async function b(){if(m>=s){const i=T(a.hora);H(i)>=u?(await J(a.id)).status==200?n(!0,"Reserva cancelada correctamente"):n(!1,"Hubo un error al eliminar su reserva, intente mas tarde"):n(!1,`No se puede cancelar la reserva faltando menos de ${u} hora/s`)}}async function x(){if(m==s){const i=T(a.hora);H(i)>=u?j(!0):n(!1,`No se puede modificar la reserva faltando menos de ${u} hora/s`)}else m>s&&j(!0)}const E=`${m.substring(8,10)}/${m.substring(5,7)}`;return t.useEffect(()=>{const i=()=>{f(window.innerWidth>768)};return window.addEventListener("resize",i),()=>{window.removeEventListener("resize",i)}},[]),e.jsxs("div",{className:"datos__body-row",children:[e.jsx("div",{className:"datos__body-dato",children:E}),e.jsx("div",{className:"datos__body-dato",children:a.hora}),e.jsxs("div",{className:"datos__body-dato datos__body-comensales",children:[e.jsx("img",{src:B,className:"user-icon",alt:"Cantidad de personas"}),a.cantidad_personas]}),e.jsx("div",{className:"datos__body-dato",children:a.lugar}),e.jsxs("div",{className:"datos__body-dato",children:[e.jsx("img",{src:w(a.estado),alt:a.estado,className:"status-img"}),g&&e.jsx("p",{children:a.estado})]}),e.jsxs("div",{className:"datos__body-dato acciones",children:[e.jsx("img",{src:Q,alt:"Modificar",className:R(a.hora,m)?"new":"old",onClick:()=>x()}),e.jsx("img",{src:A,alt:"Eliminar",className:R(a.hora,m)?"new":"old",onClick:()=>b()})]}),p.isSubmitted&&e.jsx(C,{isSubmitted:p.isClicked,isGoodStatus:p.isGood,handleSubmit:h,msg:p.msg,position:"top"}),N&&e.jsx(D,{comp:"reserva",children:e.jsx(ee,{showModalUpdate:N,reserva:a,handleCloseModalUpdate:v})})]},a.id)}function he(){const{auth:a}=O(),[s,m]=t.useState([]),[u,g]=t.useState(!0),[f,p]=t.useState({isSubmitted:!1,existError:!1,msg:""}),[o,N]=t.useState(1),[j,w]=t.useState(0),[h,v]=t.useState([]),[n,b]=t.useState(!0),x=6,E={timeZone:"America/Argentina/Buenos_Aires"},i=new Date().toLocaleString("en-US",E).split(" ")[0];t.useEffect(()=>{document.title="Alares | Mis Reservas "},[]),t.useEffect(()=>{async function r(){if(b(!0),a.data.user_id)try{const d=await K({user_id:a.data.user_id});m(d.data.data)}catch{}finally{b(!1)}}r()},[a.data.user_id]),t.useEffect(()=>{const r=[];for(let d=1;d<=Math.ceil((l().length==0?1:l().length)/x);d++)r.push(d);v(r),S(1)},[s,u]);function l(){if(s.length<=0)return[];if(u){const r=s.filter(d=>{if(L(d.fecha)>=L(i))return d});return r.length<=0?[]:r}else return s}function _(){const d=L(new Date);if(s.length<=0)return e.jsx(I,{msg:"Aun no tienes ninguna reserva hoy",msgButton:"RESERVAR",goTo:"reservas"});{const c=l();return c.length<=0?e.jsx(I,{msg:"Aun no tienes ninguna reserva hoy",msgButton:"RESERVAR",goTo:"reservas"}):c.slice(j,x+j).map(y=>{const q=y.fecha,F=new Date(q).toLocaleDateString();return e.jsx(ae,{fechaLegible:F,booking:y,fechaHoy:d},y.id)})}}function M(){p({isSubmitted:!1,existError:!1,msg:""}),document.body.classList.remove("disable-scroll")}function S(r){r!==o&&(window.scrollTo(0,10),N(r),w((r-1)*x))}return e.jsxs("div",{className:"misreservas__container",children:[e.jsx(U,{pathPrev:"Home",pathActual:"Mis Reservas",goTo:"home"}),e.jsxs("div",{className:"misreservas__form",children:[e.jsxs("div",{className:"misreservas__filter",onClick:()=>g(!u),children:[e.jsx("img",{src:$,alt:"Icono de oculto"}),e.jsx("p",{children:u?"Mostrar reservas antiguas":"Ocultar reservas antiguas"})]}),e.jsxs("div",{className:"misreservas__datos",children:[e.jsxs("div",{className:"datos__header",children:[e.jsx("p",{className:"datos__header-column",children:"Fecha"}),e.jsx("p",{className:"datos__header-column",children:"Hora"}),e.jsx("p",{className:"datos__header-column",children:"Comens."}),e.jsx("p",{className:"datos__header-column",children:"Lugar"}),e.jsx("p",{className:"datos__header-column",children:"Estado"}),e.jsx("p",{className:"datos__header-column",children:"Acciones"})]}),e.jsx("div",{className:"datos__body",children:n?e.jsx(X,{size:"small",color:"orange"}):_()})]})]}),l().length>0&&e.jsx("div",{className:"button",children:"RESERVAR"}),h.length>1&&e.jsx("div",{className:"misreservas__paginacion-wrapper",children:e.jsxs("div",{className:"misreservas__paginacion",children:[e.jsx("div",{className:"misreservas__pagina--button",children:e.jsx("p",{onClick:()=>S(o-1==0?o:o-1),children:"Previo"})}),s&&h.map(r=>e.jsx("div",{className:"misreservas__pagina",onClick:()=>S(r),children:e.jsx("p",{className:`${r==o?"active":""}`,children:r})},r)),e.jsx("div",{className:"misreservas__pagina--button",children:e.jsx("p",{onClick:()=>S(o+1>h.length?o:o+1),children:"Siguiente"})})]})}),f.isSubmitted,e.jsx(C,{isSubmitted:f.isSubmitted,isGoodStatus:!f.existError,msg:f.msg,handleSubmit:M})]})}export{he as default};
